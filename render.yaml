services:
  # Web service for the full-stack application
  - type: web
    name: analytical-lab
    env: node
    buildCommand: npm install --no-package-lock && cd client && npm install --no-package-lock && npm run build && mkdir -p ../server/client/build && cp -r build/* ../server/client/build/ && cd .. && ls -la server/client/build
    startCommand: npm start
    buildFilter:
      paths:
        - package.json
        - server/**
        - client/**
    buildEnvironment:
      # Required for building sqlite3 from source
      - name: PYTHON
        value: python3
      - name: NODE_SQLITE3_BINARY_HOST_MIRROR
        value: https://github.com/TryGhost/node-sqlite3/releases/download
    envVars:
      - key: NODE_ENV
        value: production
      - key: JWT_EXPIRES_IN
        value: 7d
      - key: JWT_SECRET
        generateValue: true
      - key: DATABASE_URL
        fromDatabase:
          name: analytical-lab-db
          property: connectionString
        # This will be automatically set by Render when the PostgreSQL database is provisioned
        # If you're not using a Render PostgreSQL database, you'll need to set this manually
      - key: FRONTEND_URL
        sync: false

# Database service
databases:
  - name: analytical-lab-db
    plan: free
    databaseName: analytical_lab_db
    user: analytical_lab_user
